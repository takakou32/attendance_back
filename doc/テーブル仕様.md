# 完全版：再修正された包括的な勤怠管理システムのテーブル仕様

## 1. 部署テーブル (departments)

| カラム名        | データ型     | NULL | キー   | デフォルト        | 説明     |
| --------------- | ------------ | ---- | ------ | ----------------- | -------- |
| department_id   | INT          | NO   | PK, AI |                   | 部署ID   |
| department_name | VARCHAR(100) | NO   |        |                   | 部署名   |
| created_at      | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時 |
| updated_at      | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時 |

## 2. 勤務地テーブル (work_locations)

| カラム名      | データ型     | NULL | キー   | デフォルト        | 説明      |
| ------------- | ------------ | ---- | ------ | ----------------- | --------- |
| location_id   | INT          | NO   | PK, AI |                   | 勤務地ID  |
| location_name | VARCHAR(100) | NO   |        |                   | 勤務地名  |
| address       | VARCHAR(255) | NO   |        |                   | 住所      |
| created_at    | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時  |
| updated_at    | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時  |

## 3. 従業員テーブル (employees)

| カラム名            | データ型     | NULL | キー   | デフォルト        | 説明                |
| ------------------- | ------------ | ---- | ------ | ----------------- | ------------------- |
| employee_id         | INT          | NO   | PK, AI |                   | 従業員ID            |
| first_name          | VARCHAR(50)  | NO   |        |                   | 名                  |
| last_name           | VARCHAR(50)  | NO   |        |                   | 姓                  |
| email               | VARCHAR(100) | NO   |        |                   | メールアドレス      |
| hire_date           | DATE         | NO   |        |                   | 入社日              |
| department_id       | INT          | NO   | FK     |                   | 部署ID              |
| position            | VARCHAR(100) | NO   |        |                   | 役職                |
| default_location_id | INT          | NO   | FK     |                   | デフォルト勤務地ID  |
| created_at          | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時            |
| updated_at          | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時            |

外部キー制約:
- `department_id` は `departments(department_id)` を参照
- `default_location_id` は `work_locations(location_id)` を参照

## 4. 日次勤務記録テーブル (daily_work_records)

| カラム名       | データ型  | NULL | キー   | デフォルト        | 説明           |
| -------------- | --------- | ---- | ------ | ----------------- | -------------- |
| record_id      | INT       | NO   | PK, AI |                   | 記録ID         |
| employee_id    | INT       | NO   | FK     |                   | 従業員ID       |
| date           | DATE      | NO   |        |                   | 勤務日         |
| start_time     | TIME      | YES  |        |                   | 開始時間       |
| end_time       | TIME      | YES  |        |                   | 終了時間       |
| break_duration | INT       | NO   |        | 0                 | 休憩時間（分） |
| location_id    | INT       | NO   | FK     |                   | 勤務地ID       |
| created_at     | TIMESTAMP | NO   |        | CURRENT_TIMESTAMP | 作成日時       |
| updated_at     | TIMESTAMP | NO   |        | CURRENT_TIMESTAMP | 更新日時       |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照
- `location_id` は `work_locations(location_id)` を参照

ユニークキー:
- `unique_employee_date` (employee_id, date)

## 5. 月次勤務記録テーブル (monthly_work_records)

| カラム名         | データ型     | NULL | キー   | デフォルト        | 説明         |
| ---------------- | ------------ | ---- | ------ | ----------------- | ------------ |
| record_id        | INT          | NO   | PK, AI |                   | 記録ID       |
| employee_id      | INT          | NO   | FK     |                   | 従業員ID     |
| year             | INT          | NO   |        |                   | 年           |
| month            | INT          | NO   |        |                   | 月           |
| total_work_hours | DECIMAL(7,2) | NO   |        | 0                 | 合計勤務時間 |
| overtime_hours   | DECIMAL(7,2) | NO   |        | 0                 | 残業時間     |
| created_at       | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時     |
| updated_at       | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時     |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照

ユニークキー:
- `unique_employee_month` (employee_id, year, month)

## 6. 勤怠異常記録テーブル (attendance_irregularities)

| カラム名        | データ型                               | NULL | キー   | デフォルト        | 説明        |
| --------------- | -------------------------------------- | ---- | ------ | ----------------- | ----------- |
| irregularity_id | INT                                    | NO   | PK, AI |                   | 異常記録ID  |
| employee_id     | INT                                    | NO   | FK     |                   | 従業員ID    |
| date            | DATE                                   | NO   |        |                   | 日付        |
| type            | ENUM('遅刻', '早退', '欠勤', 'その他') | NO   |        |                   | 異常タイプ  |
| reason          | TEXT                                   | YES  |        |                   | 理由        |
| created_at      | TIMESTAMP                              | NO   |        | CURRENT_TIMESTAMP | 作成日時    |
| updated_at      | TIMESTAMP                              | NO   |        | CURRENT_TIMESTAMP | 更新日時    |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照

## 7. 会社休日テーブル (company_holidays)

| カラム名    | データ型     | NULL | キー   | デフォルト        | 説明     |
| ----------- | ------------ | ---- | ------ | ----------------- | -------- |
| holiday_id  | INT          | NO   | PK, AI |                   | 休日ID   |
| date        | DATE         | NO   | UQ     |                   | 日付     |
| description | VARCHAR(200) | YES  |        |                   | 説明     |
| created_at  | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時 |
| updated_at  | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時 |

## 8. 従業員休暇残高テーブル (employee_leave_balances)

| カラム名           | データ型     | NULL | キー   | デフォルト        | 説明         |
| ------------------ | ------------ | ---- | ------ | ----------------- | ------------ |
| balance_id         | INT          | NO   | PK, AI |                   | 残高ID       |
| employee_id        | INT          | NO   | FK     |                   | 従業員ID     |
| year               | INT          | NO   |        |                   | 年           |
| paid_leave_balance | DECIMAL(5,1) | NO   |        | 0                 | 有給休暇残高 |
| comp_time_balance  | DECIMAL(5,1) | NO   |        | 0                 | 代休残高     |
| created_at         | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時     |
| updated_at         | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時     |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照

ユニークキー:
- `unique_employee_year` (employee_id, year)

## 9. 休暇申請テーブル (leave_requests)

| カラム名    | データ型                                       | NULL | キー   | デフォルト        | 説明       |
| ----------- | ---------------------------------------------- | ---- | ------ | ----------------- | ---------- |
| request_id  | INT                                            | NO   | PK, AI |                   | 申請ID     |
| employee_id | INT                                            | NO   | FK     |                   | 従業員ID   |
| start_date  | DATE                                           | NO   |        |                   | 開始日     |
| end_date    | DATE                                           | NO   |        |                   | 終了日     |
| leave_type  | ENUM('有給休暇', '代休', '特別休暇', 'その他') | NO   |        |                   | 休暇タイプ |
| reason      | TEXT                                           | YES  |        |                   | 理由       |
| status      | ENUM('申請中', '承認', '却下')                 | NO   |        | '申請中'          | 状態       |
| approver_id | INT                                            | YES  | FK     |                   | 承認者ID   |
| created_at  | TIMESTAMP                                      | NO   |        | CURRENT_TIMESTAMP | 作成日時   |
| updated_at  | TIMESTAMP                                      | NO   |        | CURRENT_TIMESTAMP | 更新日時   |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照
- `approver_id` は `employees(employee_id)` を参照

## 10. 残業申請テーブル (overtime_requests)

| カラム名        | データ型                       | NULL | キー   | デフォルト        | 説明      |
| --------------- | ------------------------------ | ---- | ------ | ----------------- | --------- |
| request_id      | INT                            | NO   | PK, AI |                   | 申請ID    |
| employee_id     | INT                            | NO   | FK     |                   | 従業員ID  |
| date            | DATE                           | NO   |        |                   | 日付      |
| requested_hours | DECIMAL(4,2)                   | NO   |        |                   | 申請時間  |
| reason          | TEXT                           | YES  |        |                   | 理由      |
| status          | ENUM('申請中', '承認', '却下') | NO   |        | '申請中'          | 状態      |
| approver_id     | INT                            | YES  | FK     |                   | 承認者ID  |
| created_at      | TIMESTAMP                      | NO   |        | CURRENT_TIMESTAMP | 作成日時  |
| updated_at      | TIMESTAMP                      | NO   |        | CURRENT_TIMESTAMP | 更新日時  |

外部キー制約:
- `employee_id` は `employees(employee_id)` を参照
- `approver_id` は `employees(employee_id)` を参照

## 11. 勤怠ポリシーテーブル (attendance_policies)

| カラム名            | データ型     | NULL | キー   | デフォルト        | 説明         |
| ------------------- | ------------ | ---- | ------ | ----------------- | ------------ |
| policy_id           | INT          | NO   | PK, AI |                   | ポリシーID   |
| department_id       | INT          | YES  | FK     |                   | 部署ID       |
| standard_work_hours | DECIMAL(4,2) | NO   |        |                   | 標準勤務時間 |
| max_overtime_hours  | DECIMAL(4,2) | YES  |        |                   | 最大残業時間 |
| created_at          | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 作成日時     |
| updated_at          | TIMESTAMP    | NO   |        | CURRENT_TIMESTAMP | 更新日時     |

外部キー制約:
- `department_id` は `departments(department_id)` を参照

注意事項:
1. すべてのテーブルに `created_at` と `updated_at` カラムを追加し、レコードの作成日時と最終更新日時を追跡しています。
2. 外部キー制約を使用して、テーブル間の関連性を保証しています。
3. 適切な場所にユニークキーを設定し、データの一意性を確保しています。
4. ENUM型を使用して、特定のカラムの値を制限しています。
5. 日付と時間に関連するカラムには、それぞれDATE型とTIME型を使用しています。
6. 金額や時間に関連する数値にはDECIMAL型を使用し、適切な精度を設定しています。

この仕様書は、包括的な勤怠管理システムの基本的なデータベース構造を提供します。実際の実装時には、パフォーマンスの最適化やセキュリティの考慮など、追加の設定が必要になる場合があります。